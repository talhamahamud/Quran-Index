<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='koran.png') }}" />

    <!-- Open Graph tags -->
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}কুরআনের আয়াতগুলোকে বিষয়ভিত্তিক ও সূরা অনুযায়ী সাজানো একটি সহজ সংগ্রহ।{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ url_for('static', filename='koran.png', _external=True) }}{% endblock %}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">


    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Tiro+Bangla:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <title>{% block title %}বিষয় ভিত্তিক আয়াত{% endblock %}</title>
  </head>
  <body>
    <div class="menu-icon" onclick="toggleMenu()">
      <span></span>
      <span></span>
      <span></span>
    </div>

    <nav id="navbar">
      <header>বিষয় ভিত্তিক আয়াত</header>
      <div class="subheader">
        <a href="{{ url_for('about') }}">About</a>
        {% if current_user.is_authenticated %}
        <span style="margin: 0 5px;">|</span>
        <a href="{{ url_for('create_post') }}">Create Post</a>
        <span style="margin: 0 5px;">|</span>
        <a href="{{ url_for('logout') }}">Logout</a>
        {% endif %}
      </div>
      <ul>
        <!-- Legacy Static Pages (Migrated to Dynamic) -->
        <li class="{% if request.path == url_for('index') %}veg{% endif %}"><a class="link" href="{{ url_for('index') }}">জান্নাতের বর্ননা</a></li>
        <!-- Dynamic Posts -->
        {% for post in db_posts %}
        <li class="{% if request.path == url_for('show_post', slug=post.slug) %}veg{% endif %}">
            <a class="link" href="{{ url_for('show_post', slug=post.slug) }}">{{ post.title }}</a>
        </li>
        {% endfor %}
      </ul>
    </nav>

    <main id="main-doc">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="ayat alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <script>
      function toggleMenu() {
        const navbar = document.getElementById("navbar");
        navbar.classList.toggle("open");
      }

      // Close menu when clicking on a link in mobile view
      document.querySelectorAll("#navbar a").forEach((link) => {
        link.addEventListener("click", () => {
          if (window.innerWidth <= 815) {
            document.getElementById("navbar").classList.remove("open");
          }
        });
      });

      // Close menu when clicking outside
      document.addEventListener("click", (e) => {
        const navbar = document.getElementById("navbar");
        const menuIcon = document.querySelector(".menu-icon");
        if (
          window.innerWidth <= 815 &&
          !navbar.contains(e.target) &&
          !menuIcon.contains(e.target)
        ) {
          navbar.classList.remove("open");
        }
      });

      // Persist Sidebar Scroll Position
      document.addEventListener("DOMContentLoaded", function() {
        var sidebar = document.querySelector("#navbar ul");
        var scrollPos = sessionStorage.getItem("sidebar-scroll");
        if (scrollPos && sidebar) {
            sidebar.scrollTop = scrollPos;
        }

        if(sidebar) {
            window.addEventListener("beforeunload", function() {
                sessionStorage.setItem("sidebar-scroll", sidebar.scrollTop);
            });
        }
      });
    </script>
  </body>
</html>
